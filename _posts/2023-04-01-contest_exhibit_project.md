---
layout: post
title:  "Build a diagnostic UI for lung diseases using AI Vision"
info: "2023.04~ 2023.12"
tech: "python"
type: Hanium Contest project
---


## I. 프로젝트 개요

**1. 프로젝트 소개**

- 최근 대규모 네트워크 아키텍처와 대량의 레이블 데이터셋의 등장으로 딥러닝 기술을 이용하여 의료 영상 해석 작업에서 높은 성능 수준 달성 가능
- Vision 기술을 활용해 폐결핵, 기흉, 결절 같은 폐 질환을 진단하고 합병증 등을 고려하여 진행상태, 응급정도를 파악할 수 있는 AI 모델을 개발함
- AI 모델을 활용한 폐렴 추론 진단 결과 및 환자의 추가 진단 이력 조회 가능한 Platform 으로 보다 편리한 환자 진단 이력 조회 시스템 구축함

**2. 개발 배경 및 필요성**

1. 폐질환의 위험성은 지속적으로 증가하고 있으며 특히 예방과 조기 치료가 중요시되는 질환 중 하나
    - 폐렴의 경우 초기에 나타날 수 있는 증상이 감기와 비슷하기 때문에 초기 치료 시기를 놓치기가 쉬우며 노년층의 경우 이 같은 폐렴 증상이 관찰되지 않기도 하여 많은 관심이 필요한 질환임
    - 노인 폐렴은 증상 없이 찾아오기 때문에 자칫하면 ‘골든타임’을 놓쳐 사망하는 사례가 급증

1. 흉부외과 전문의가 부족한 상황, 중증질환 응급체계 강화를 위해 AI를 활용한 진단 보조 시스템의 필요성이 대두되고 있음

1. 의료 환경에 AI 도입을 통한 임상 의사결정 효율성 확대 필요
    - 폐질환의 효율적인 치료와 전문의 부족으로 나타나는 문제에 대한 지원으로써 폐질환에 AI 판독 시스템을 도입
    - 흉부 X-ray를 기반으로 지속적인 모니터링을 통해 폐질환에 대한 위험도를 예상하고 초기 진단 및 예방적인 성과를 확보할 수 있음
    - 폐렴 진단에서 의료진에 따라 주관적인 해석이 가능하다는 불완전성이 있기때문에 의사들의 **업무 보조 수단**으로 정확하고 효율적인 진단에 활용될 수 있음
    - 향후 수집된 데이터를 이용하여 재학습을 할 경우, 진단 모델의 성능을 향상시켜 보다 정확한 사전진단 시스템을 구축할 수 있음.

1. 효율적인 진료 계획 수립
    - 경우에 따라 이상소견 분석에 빠른 판독이 필요한 경우가 있음
    - 의사는 응급환자를 구분하여 신속한 대응에 필요한 상황에서, AI 판독 기술을 적용하 면 응급환자 촬영 후 진단까지 소요되는 시간을 줄일 수 있을 것으로 예상

1. 비용 절감
    - 컴퓨터 비전 기술을 이용하면 인력과 시간에 대한 비용을 절감 가능
    - 의료 비용을 줄일 수 있으며, 빠른 치료가 가능해지므로 환자의 치료 비용도 감소할 수 있음

**3. 프로젝트 특·장점**

1. 특이점
    - 업무를 효율적으로 할 수 있도록, 모델을 통한 classification 및 anormaly detection 이외에도 환자 진료기곡, 특이사항, 환자 개인정보등을 검색하여 찾아볼 수 있게 한다. 
    - 환자를 진단 할 때는 복합적인 요인을 고려한다. x-ray를 진단하는 모델은 환자의 나이, 성별, 검진기록, 지병 등을 파악하지 않고 이미지 만을 가지고 판별한다. 
    - AI 모델은 보조 진단의 수단으로써, 빠른 판단을 내리기 위한 핵심적인 요소이지만, 판단을 위한 근거는 이미지 만으로는 부족하다. 따라서 환자의 정보를 파악하는 인터페이스를 구성한다. 
    - 환자의 진료 정보는 이전 진료 기록, 약물 및 음식에 대한 특이반응, 지병 등이 포함된다. 환자를 진단하기에 필수적인 요소들을 출력하므로써, 환자에 대한 이해도가 높아 질 수 있는 효과를 야기한다.
    - 폐질환 진단 시, 폐렴의 유무 이외에도 흉부 X-Ray 사진으로부터 병변 의심 부위를 학습시켜 Labeling 과정을 통해 폐렴이 추정되는 위치 파악 가능하며 시각화한다.

1. 장점
    - 본 프로젝트의 주요한 장점은 환자와 의사간에 신뢰있는 진단을 진행 가능하다는 것이다. 의사의 독자적인 판단보다 학습된 AI 모델에 이루지는 판단과 의사의 판단을 고려한 진단을 진행한다. 이런 흐름은 환자 입장에서 더 신뢰 수 있다.
    - 효율적인 업무가 가능하다. AI 모델을 사용하는 하면 자동화가 가능해진다. 자동화는 몇번의 검색이나 클릭으로 복잡한 프로세스를 단순화하게 만든다. 진단 프로세스를 자동화하는 것은 의사들의 업무의 비중을 줄여준다. 업무의 비중이 줄어드는 것은 그만큼 환자를 더 자세히 파악할 수 있다는 의미이다.
    - 클라우드를 통해 서비스함으로써 향후 다양한 의료 플랫폼에 효율적으로 접목하여 다양한 시너지 창출 가능

## II. 프로젝트 내용

**1. 프로젝트 구성도**

![구성도](figure1.png)

**2. 프로젝트 기능**

| 기능 |  내용 |
| --- | --- |
| 서비스 인터페이스- Web page | 웹페이지 접근시 환자의 기초검사 항목들을 확인 가능, local pc 에서 지정된 port 를 통해 접속 가능 |
| 환자 진단 이력 조회 | 환자 ID로 특정 환자 조회 가능, 로그인, 환자 개인정보 등에 대해 저장된 저장소 |
| 폐질환 추론 진단AI - Classification | 흉부 X-Ray 사진 업로드 시, 학습된 AI 폐렴진단 모델을 통해 추론 진단 결과 출력, Anormaly detection 모델을 활용해 데이터 셋에 맞는 모델을 생성 |
| 폐 이상 영역 추론AI - anormaly detection | 흉부 X-Ray 사진에 대한 추가적인 영상처리 과정을 통해 폐렴 위치 추론 후 이미지 출력, 이미지에서 환자의 질환 위치와 질병명 등을 추출|


**3. 주요 적용 기술**

1) AI 폐렴 추론 진단 모델

![모델](model1.png)

[X. Ouyang et al., "Learning Hierarchical Attention for Weakly-Supervised Chest X-Ray Abnormality Localization and Diagnosis," in IEEE Transactions on Medical Imaging, vol. 40, no. 10, pp. 2698-2710, Oct. 2021, doi: 10.1109/TMI.2020.3042773.]


1. hierarchical visual attention framework
    * foreground attention: cascade 설계를 통해 효과적인 attention feature map 을 더 잘 표현  abnormal regions 에 대한 spatial prior 정보 역할
    * positive attention: gradient-based attention 메커니즘을 통해 실현되는 관심 영역의 대략적인 경계
    * abnormality attention: 관심 영역의 특정 이상을 묘사하는 것으로, D-방향(이상 유형) 분류 체계(abnormality attention)를 사용한 gradient-based attention 을 통해 실현

2. Attention Mechanism

    * Attention: long range dependency 문제를 해결하기 위한 개념. 여러 입력값들에 대한 dot product를 통해 전역적 feature map 을 구성
    * Foreground attentioin block: channel wise attention 과 poistion wise attention 을 이용해 feature 을 embedding. channel attention 에서는 1x1 convoluion 과 fully connnected layer 를 태워 channel 가중치가 있는 C×1 벡터를 출력하고 poistion wise attention 에서는 채널 가중치가 부여된(위의 C×1 벡터에 의해) C × H × W 특징 맵은 위치별 주의 모듈에 의해 처리되어 주의 가중치가 부여된 1 × H × W 맵을 생성

3. Weakly-supervised Learning

    * 추가적인 annotation 을 학습한다.(실제 모델에 많은 영향을 끼치지 않지만 직접적인 감독을 제공할 수 있다.
    * 적응형 평균제곱오차(AMSE) 손실인 L_amse를 적용하여 Weakly-supervised Learning 성능을 향상시킨다
    * BBOX annotation 으로 네트워크의 추가 인스턴스를 훈련한다.

4. 스케일 조정(Scale Scaling)

    * 네트워크의 깊이, 너비 및 해상도를 조정하는 계수 결정
    * 스케일 조정 계수에 따라 다른 하이퍼파라미터들을 조정하여 균형 유지

5. 네트워크 아키텍처 탐색(Network Architecture Search)

    * 컨볼루션 레이어, 활성화 함수, 풀링 레이어 등 구성 요소와 연결 방식 탐색.
    * 구성 요소의 선택은 성능과 계산 비용을 균형있게 유지하도록 최적화.


**4. 프로젝트 시연**

![시연](figure2.png)

![시연](figure3.png)

![시연](figure4.png)

![시연](figure5.png)



**5. 프로젝트 개발 환경**

| **구분** |  | **상세내용** |
| --- | --- | --- |
| S/W 개발환경 | OS | Window, Mac OS |
|  | 개발환경(IDE) | Visual Studio Code, Flask, Anaconda, Docker |
|  | 개발도구 | Colab, Anaconda, Jupyter notebook, streamlit |
|  | 개발언어 | Python |
|  | 기타사항 | N/A |
| 프로젝트관리환경 | 형상관리 | GitLab, Github |
|  | 의사소통관리 | 카카오톡, Zoom 정기 온라인 회의, discord |
|  | 기타사항 | 토즈 오프라인 미팅 |

## III. 기대효과 및 활용분야

**1. 프로젝트의 기대효과**

- 유의미한 데이터 생성을 통한 의료 연구편의 확보
- AI Vision의 흉부 X-ray 판독을 통해 질환에 대한 진단 정보를 가진 의미있는 데이터 생성
- 폐질환에 대한 빅데이터 생성의 가속화함으로써 의료 연구 활성화 및 연구 결과물의 정확도 증가
- 서울/수도권 지역의 의료 집중 현상으로 인한 불균형을 ‘AI Vision을 이용한 폐 질환진단 프로그램’을 통해 완화 가능
- 의료진의 의사결정 지원 도구로써 활용
- 질환의 특성을 고려한 이미지 데이터 레이블링 기능을 통해 신속하고 효율적인 진단을 지원함
- AI의 보조 기능 외 의료진의 직접적인 에디터 기능 및 협진을 위한 툴로 고도화하여 활용될 수 있음
- 에디터 기능을 활용함으로써 결과물에 대한 전문의의 피드백을 통해 AI Vision의 정밀도를 증가시켜 나감
- 진단부터 치료과정까지 소요되는 시간 단축을 통해 환자와 의사 모두 만족할 수 있 는 진료 프로세스 설계 가능


**2. 프로젝트의 활용분야**

- 의료 영상&이미지 판독 서비스로 다양한 의료 플랫폼과의 결합을 통한 높은 확산성 기대
- 최근 수많은 의료 SaaS 플랫폼이 등장하고 있으며 상급병원은 각각의 고유한 병원시스템을 고도화하거나 새로운 의료 플랫폼으로의 전환을 통해 첨단 의료 환경을 구축 하고 있음
- 프로젝트의 결과물을 서비스로써 플랫폼에 쉽게 도입이 가능한 형태로 전환하여 의료 시장의 진출의 방법을 확보할 수 있음
- 판독 가능한 질환 확대를 통해 CDSS (임상의사결정지원시스템)와 같은 연구에 활동 가능한 유의미한 데이터 확보 및 확산
- 환자의 임상정보를 기반으로 다양한 질환에 대한 예측을 위한 프로세스가 연구되고 있음
- 해당 프로젝트 결과물이 상용화되어 지속적으로 데이터가 축적되고 활용된다며 CDSS 연구에 활용 가능한 빅데이터를 제공할 수 있을 것으로 예상됨
- 폐질환에서 흉부 질환으로 범위를 확대하며 중증질환의 위험성 개선 및 예방
- 응급체계의 중요성이 대두되고 있는 흉부 질환의 전반적인 판독이 가능하도록 프로젝트 결과물을 고도화
- 지속적인 흉부 질환 모니터링을 통해 중증질환을 예방하고 환자에게 효과적인 치료를 제공할 수 있음
- 의료 데이터 분석을 통해 질병의 유행과 위험 요소를 파악하여 보다 정확한 예방 및 치료방안 제시 가능